name: DevSecOps Pipeline

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  secrets-trufflehog:
    uses: ./.github/workflows/secret-scan-trufflehog.yml
    secrets:
      DD_URL: ${{ secrets.DD_URL }}
      DD_TOKEN: ${{ secrets.DD_TOKEN }}
    with:
      DD_PRODUCT_NAME: ${{ github.event.repository.name }}
      DD_ENGAGEMENT_NAME: ci-${{ github.event.repository.name }}

  sca-trivyfs:
    uses: ./.github/workflows/sca-trivyfs.yml
    secrets:
      DD_URL: ${{ secrets.DD_URL }}
      DD_TOKEN: ${{ secrets.DD_TOKEN }}
    with:
      DD_PRODUCT_NAME: ${{ github.event.repository.name }}
      DD_ENGAGEMENT_NAME: ci-${{ github.event.repository.name }}
    needs: [secrets-trufflehog]